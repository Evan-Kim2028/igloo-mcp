# Release 0.2.3 Plan

## Workflow Snapshot

- **Branching model**: GitFlow (`main`, `develop`, `feature/*`, `release/*`, `hotfix/*`).
- **Current target**: create/maintain `develop` for 0.2.3 integration, then cut `release/0.2.3` once the fixes below land.
- **Stabilization**: version bump + QA happen on `release/0.2.3`, followed by merges into `main` (tag `v0.2.3`) and back into `develop`.

## Issue Backlog Slated for 0.2.3

| Issue | Source | Proposed 0.2.3 Actions |
|-------|--------|------------------------|
| **MCP tool-call timeout mismatch (120s cap)** | `docs/known-issues/tool-call-timeout-mismatch.md` and `notes/bugs/issue_mcp_tool_timeout_120s.md` | Add async execution + polling (`response_mode=async` + `fetch_async_query_result`) so long queries return immediately with an `execution_id`, and document how to use it when CLI timeouts can't be raised. Ensure regression tests cover the async path and cache reuse. |
| **Issue #2 – UNION blocked by SQL guardrails** | `docs/issue-2-plan.md` | Finish the pending “verify tests pass” task now that CI is available, make sure the new normalization logic is enabled by default, and add release notes describing the expanded allow-list for set operators. |
| **Structured MCP error payloads + parameter alignment** | `.github/ISSUE_DRAFTS/structured-mcp-errors.md` and `pr-structured-errors-align-timeout.md` | Land the type-alignment fix for `timeout_seconds`, add the centralized error translation helper, and cover parameter/enum/range failures with machine-readable payloads. Document the error codes in API docs. |
| **Per-repo artifact root confusion** | `.github/ISSUE_DRAFTS/per_repo_artifact_root.md` | Update onboarding docs to call out exporting `IGLOO_MCP_QUERY_HISTORY`/`IGLOO_MCP_ARTIFACT_ROOT` before starting the MCP server, detect divergent history/artifact directories at runtime, and emit a warning in `audit_info`. |
| **Post-query insight plumbing + describe_logging_paths tool** | `notes/namespace_audit/plan.md` | Ship the new `post_query_insight` parameter (with `metric_insight` alias), the `record_query_insight` tool, cache manifest updates, and the `describe_logging_paths` helper. Add doc examples per the plan and ensure concurrency-safe logging. |
| **execute_query v2 modes (`safe`/`explain`/metadata)** | `.github/ISSUE_DRAFTS/execute_query_v2.md` | Scope phase 1 for 0.2.3: introduce the `mode` enum, auto-LIMIT safety mode, result metadata (`columns`, `rows_truncated`), and documentation. Advanced mode/session-parameter whitelist can follow if time allows. |

## Status Updates (2025-11-14)

- [x] **Timeout mismatch mitigation (#23/#27)** — `execute_query` now automatically inlines up to the MCP RPC budget, then falls back to async polling so responses are never lost at 120s. `fetch_async_query_result` gained parity docs/tests and cache manifests capture the derived `key_metrics`/`insights` payloads.
- [x] **SHOW lexical fallback (#24)** — SQL validator strips leading comments/whitespace before checking for `SHOW`, ensuring comment-prefixed SHOW statements are allowed/blocked purely by permissions. Regression tests added (`tests/test_sql_validation_enhanced.py`).
- [ ] **Release packaging/docs (#18)** — still need to finalize changelog/README/tool docs and cut `release/0.2.3` after the remaining issues (artifact roots, structured errors, execute_query v2) land.

## Release Readiness Checklist

- [ ] `develop` contains all issue fixes with passing CI (ruff, mypy, pytest, integration harness).
- [ ] `release/0.2.3` created with version bump, changelog entry, and documentation updates (README + tool docs referencing new behavior/features).
- [ ] Long-running timeout regression suite covers both Snowflake cancellation and MCP RPC TTL alignment.
- [ ] Structured error matrix documented and referenced from `docs/api/errors.md`.
- [ ] New tools (`record_query_insight`, `describe_logging_paths`) and execute_query modes have usage examples in `docs/api/tools/`.
- [ ] Release signed/tagged as `v0.2.3`, merged into `main`, then back into `develop`.

Maintain this file as issue status evolves during the cycle.
