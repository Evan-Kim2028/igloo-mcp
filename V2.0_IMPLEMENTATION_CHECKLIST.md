# Nanuk MCP v2.0 - Implementation Checklist

**Objective:** Complete pure MCP transformation in 5-6 weeks
**Status:** Ready to execute
**Last Updated:** October 7, 2025

Use this checklist to track progress through each phase.

---

## Pre-Flight Checks

Before starting, verify:

- [ ] Current version is 2.0.0 in pyproject.toml
- [ ] All changes committed, working directory clean
- [ ] Tests passing: `pytest tests/`
- [ ] `uv` installed: `uv --version`
- [ ] Python 3.12+: `python --version`
- [ ] Team alignment on aggressive timeline
- [ ] Breaking changes approved

**Ready to start?** → Proceed to Phase 1

---

## Phase 1: Preparation & Analysis (Week 1)

### Day 1-2: MCP Feature Parity Audit

- [ ] Create script: `scripts/audit_mcp_parity.py`
- [ ] Run audit: `python scripts/audit_mcp_parity.py > MCP_FEATURE_PARITY.md`
- [ ] Review feature matrix, identify gaps
- [ ] **Decision:** Are all CLI features available via MCP?
  - [ ] Yes → Proceed
  - [ ] No → Implement missing MCP tools first

**Gaps to check:**
- [ ] `execute_query` tool exists
- [ ] `preview_table` tool exists
- [ ] `build_catalog` tool exists
- [ ] `query_lineage` tool exists
- [ ] `build_dependency_graph` tool exists
- [ ] `parallel_query` tool (may need implementation)
- [ ] `export_ddl` tool (may need implementation)
- [ ] `health_check` tool exists
- [ ] `test_connection` tool exists
- [ ] `get_config` tool (may need implementation)
- [ ] `validate_sql` tool exists

### Day 3: Create v1.x LTS Branch

```bash
git checkout -b v1.x-lts
git push origin v1.x-lts
git checkout main
```

- [ ] Create `v1.x-lts` branch
- [ ] Push to GitHub
- [ ] Add branch protection rules
- [ ] Update README with support policy
- [ ] Announce v1.x LTS in Discussions

### Day 4: Document Breaking Changes

- [ ] Create `/docs/v2.0_breaking_changes.md`
  - [ ] List all removed files
  - [ ] List all removed commands
  - [ ] List dependency changes
  - [ ] Document migration paths

- [ ] Create `/docs/migration-from-v1.md`
  - [ ] MCP user migration (easy)
  - [ ] CLI user migration (decision required)
  - [ ] Code examples (before/after)
  - [ ] Troubleshooting section

### Day 5: Test Coverage Baseline

```bash
pytest --cov=src/nanuk_mcp --cov-report=html --cov-report=term
```

- [ ] Run coverage report
- [ ] Document current coverage: _____ %
- [ ] Identify untested areas
- [ ] Set target: >90% after refactor

**Phase 1 Complete?** → Proceed to Phase 2

---

## Phase 2: Aggressive Code Deletion (Week 2-3)

### Day 1: Delete CLI Code

```bash
git checkout -b v2.0-pure-mcp

# Delete CLI entrypoint
git rm src/nanuk_mcp/cli.py

# Delete ALL commands
git rm -r src/nanuk_mcp/commands/

git commit -m "refactor(v2.0): remove CLI code - MCP-only architecture

BREAKING CHANGE: All CLI commands removed. Use MCP server.
See docs/v2.0_breaking_changes.md for migration guide."
```

- [ ] Create feature branch: `v2.0-pure-mcp`
- [ ] Delete `src/nanuk_mcp/cli.py`
- [ ] Delete `src/nanuk_mcp/commands/` (entire directory)
- [ ] Commit with breaking change message
- [ ] Push to GitHub

**Files deleted:**
- [ ] `cli.py` (138 LOC)
- [ ] `commands/__init__.py` (202 LOC)
- [ ] `commands/analyze.py` (540 LOC)
- [ ] `commands/discover.py` (213 LOC)
- [ ] `commands/query.py` (318 LOC)
- [ ] `commands/setup.py` (401 LOC)
- [ ] `commands/registry.py` (68 LOC)
- [ ] `commands/utils.py` (27 LOC)

**Total LOC deleted:** _____ (target: ~1,907)

### Day 1-2: Update pyproject.toml

- [ ] Remove `click>=8.0.0` from dependencies
- [ ] Remove `rich>=13.0.0` from dependencies
- [ ] Remove `nanuk = "nanuk_mcp.cli:main"` from [project.scripts]
- [ ] Keep `nanuk-mcp = "nanuk_mcp.mcp_server:main"`
- [ ] Update description: "Pure MCP server..."
- [ ] Update keywords: add "mcp", "llm", "agent"
- [ ] Update project URLs (if repo renamed)
- [ ] Commit changes

### Day 2: Remove CLI Dependencies

```bash
uv remove click rich
uv sync
uv pip list | grep -E "(click|rich)" || echo "✓ CLI deps removed"
```

- [ ] Run `uv remove click rich`
- [ ] Run `uv sync`
- [ ] Verify removal: no click, no rich in `uv pip list`
- [ ] Commit lockfile changes

### Day 2-3: Fix Imports Across Codebase

Create cleanup script:

```python
# scripts/remove_cli_imports.py
import re
from pathlib import Path

# (See full script in main plan)
```

- [ ] Create `scripts/remove_cli_imports.py`
- [ ] Run script: `python scripts/remove_cli_imports.py`
- [ ] Review changes (git diff)
- [ ] Commit: "refactor: remove CLI imports"

**Files to check:**
- [ ] `src/nanuk_mcp/__init__.py`
- [ ] `src/nanuk_mcp/config.py`
- [ ] `src/nanuk_mcp/mcp_server.py`
- [ ] All service files
- [ ] Test files

### Day 3: Update __init__.py

- [ ] Remove CLI exports from `src/nanuk_mcp/__init__.py`
- [ ] Keep only: services, config, mcp_main
- [ ] Test imports: `python -c "from nanuk_mcp import QueryService"`
- [ ] Commit changes

### Day 4: Fix Broken Tests

```bash
# Find test files that import CLI
rg "from nanuk_mcp.cli" tests/
rg "from nanuk_mcp.commands" tests/

# Delete CLI test files
rm -rf tests/test_cli.py tests/test_commands/
```

- [ ] Identify broken test imports
- [ ] Delete `tests/test_cli.py`
- [ ] Delete `tests/test_commands/` directory
- [ ] Update remaining tests to use service layer
- [ ] Run tests: `pytest tests/`
- [ ] All tests passing? → Proceed

### Day 5: Initial Verification

```bash
# Build package
uv build

# Install locally
pip install dist/nanuk_mcp-2.0.0-*.whl

# Test MCP server
SNOWFLAKE_PROFILE=test nanuk-mcp
```

- [ ] Build package successfully
- [ ] Install locally
- [ ] MCP server starts
- [ ] No import errors
- [ ] Commit all changes

**Phase 2 Complete?** → Proceed to Phase 3

---

## Phase 3: Package Restructure (Week 4)

### Day 1: Create core/ Directory

```bash
mkdir -p src/nanuk_mcp/core

# Move core modules
mv src/nanuk_mcp/config.py src/nanuk_mcp/core/
mv src/nanuk_mcp/profile_utils.py src/nanuk_mcp/core/
mv src/nanuk_mcp/session_utils.py src/nanuk_mcp/core/
mv src/nanuk_mcp/error_handling.py src/nanuk_mcp/core/
mv src/nanuk_mcp/sql_validation.py src/nanuk_mcp/core/
mv src/nanuk_mcp/circuit_breaker.py src/nanuk_mcp/core/

# Create __init__.py
touch src/nanuk_mcp/core/__init__.py
```

- [ ] Create `src/nanuk_mcp/core/` directory
- [ ] Move 6 core modules to `core/`
- [ ] Create `core/__init__.py`
- [ ] Commit: "refactor: consolidate core modules"

**Modules moved:**
- [ ] `config.py` → `core/config.py`
- [ ] `profile_utils.py` → `core/profile_utils.py`
- [ ] `session_utils.py` → `core/session_utils.py`
- [ ] `error_handling.py` → `core/error_handling.py`
- [ ] `sql_validation.py` → `core/sql_validation.py`
- [ ] `circuit_breaker.py` → `core/circuit_breaker.py`

### Day 1-2: Update All Imports

Create import update script:

```python
# scripts/update_imports.py
# (See full script in main plan)
```

- [ ] Create `scripts/update_imports.py`
- [ ] Run script: `python scripts/update_imports.py`
- [ ] Review changes (git diff)
- [ ] Run tests: `pytest tests/`
- [ ] Fix any broken imports manually
- [ ] Commit: "refactor: update imports for core/ restructure"

### Day 2-3: Simplify Service Layer

Review each service file:

- [ ] `src/nanuk_mcp/services/query.py`
  - [ ] Remove CLI-specific formatting logic
  - [ ] Return pure Pydantic models
  - [ ] Make fully async

- [ ] `src/nanuk_mcp/catalog/service.py`
  - [ ] Remove CLI-specific error formatting
  - [ ] Use structured exceptions

- [ ] `src/nanuk_mcp/dependency/service.py`
  - [ ] Remove CLI-specific logic

- [ ] `src/nanuk_mcp/lineage/queries.py`
  - [ ] Review, simplify if needed

- [ ] Commit: "refactor: simplify service layer"

### Day 3-4: Verify New Structure

```bash
# List new structure
tree src/nanuk_mcp -L 2

# Expected:
# src/nanuk_mcp/
# ├── __init__.py
# ├── mcp_server.py
# ├── mcp/
# ├── services/
# ├── catalog/
# ├── dependency/
# ├── lineage/
# ├── core/          ← NEW
# └── models/
```

- [ ] Verify directory structure
- [ ] Test all imports
- [ ] Run full test suite: `pytest tests/`
- [ ] All tests passing? → Proceed

### Day 5: Update Services __init__.py

```python
# src/nanuk_mcp/services/__init__.py

from .query import QueryService
from .catalog import CatalogService
from .lineage import LineageService
from .dependency import DependencyService

__all__ = [
    'QueryService',
    'CatalogService',
    'LineageService',
    'DependencyService',
]
```

- [ ] Create/update `services/__init__.py`
- [ ] Export main service classes
- [ ] Test imports: `from nanuk_mcp.services import QueryService`
- [ ] Commit changes

**Phase 3 Complete?** → Proceed to Phase 4

---

## Phase 4: Documentation Overhaul (Week 5)

### Day 1: Rewrite README.md

- [ ] Backup current README: `cp README.md README.old.md`
- [ ] Rewrite with MCP-only focus
  - [ ] Update title: "Nanuk MCP - Snowflake MCP Server"
  - [ ] Add v2.0 breaking changes warning
  - [ ] Remove all CLI examples
  - [ ] Add MCP usage examples
  - [ ] Update Quick Start (MCP-only)
  - [ ] Add AI assistant integration examples
  - [ ] Update features list (remove CLI)
  - [ ] Add MCP tools table
  - [ ] Link to migration guide
- [ ] Review with team
- [ ] Commit: "docs: rewrite README for v2.0 MCP-only"

### Day 2: Create Migration Guide

- [ ] Create `/docs/migration-from-v1.md` (see template in main plan)
  - [ ] MCP users section (easy migration)
  - [ ] CLI users section (decision required)
  - [ ] Before/after examples
  - [ ] CLI → MCP command mapping
  - [ ] Troubleshooting section
  - [ ] FAQ
- [ ] Review with team
- [ ] Commit: "docs: add v2.0 migration guide"

### Day 2-3: Create Breaking Changes Doc

- [ ] Create `/docs/v2.0_breaking_changes.md`
  - [ ] List all removed files
  - [ ] List all removed commands
  - [ ] List dependency changes
  - [ ] Import path changes
  - [ ] Migration timeline
  - [ ] Support policy for v1.x
- [ ] Commit: "docs: add breaking changes document"

### Day 3: Update MCP Tools Reference

- [ ] Create `/docs/mcp-tools.md` (or update existing)
  - [ ] Complete list of all 11+ tools
  - [ ] Each tool: description, arguments, examples
  - [ ] Add usage examples with AI assistants
  - [ ] Add programmatic usage examples
- [ ] Commit: "docs: comprehensive MCP tools reference"

### Day 3-4: Update Configuration Guide

- [ ] Update `/docs/configuration.md`
  - [ ] Remove CLI config sections
  - [ ] Focus on MCP server config
  - [ ] Environment variables
  - [ ] Profile setup
  - [ ] Examples for different AI assistants
- [ ] Commit: "docs: update configuration for MCP-only"

### Day 4: Update Architecture Docs

- [ ] Update `/docs/architecture.md`
  - [ ] Remove CLI layer from diagrams
  - [ ] Show pure MCP architecture
  - [ ] Update component descriptions
  - [ ] Add service layer explanation
- [ ] Commit: "docs: update architecture for v2.0"

### Day 4-5: Update CONTRIBUTING.md

- [ ] Update `/CONTRIBUTING.md`
  - [ ] Remove CLI development sections
  - [ ] Add MCP tool development guide
  - [ ] Update testing instructions
  - [ ] Update code style (remove CLI patterns)
- [ ] Commit: "docs: update contributing guide"

### Day 5: Remove CLI References

```bash
# Find CLI references in docs
rg "nanuk --" docs/ | wc -l
rg "nanuk catalog" docs/ | wc -l
rg "nanuk query" docs/ | wc -l

# Review and update each file
```

- [ ] Scan all docs for CLI references
- [ ] Replace with MCP examples
- [ ] Delete CLI-specific docs:
  - [ ] `docs/cli-reference.md` (if exists)
  - [ ] `docs/cli-examples.md` (if exists)
- [ ] Update all remaining docs
- [ ] Commit: "docs: remove CLI references"

**Phase 4 Complete?** → Proceed to Phase 5

---

## Phase 5: Testing & Quality Assurance (Week 6)

### Day 1: Add MCP Integration Tests

```python
# tests/integration/test_mcp_server.py
# (See examples in main plan)
```

- [ ] Create `tests/integration/test_mcp_server.py`
- [ ] Test MCP server startup
- [ ] Test all 11+ MCP tools via MCP protocol
- [ ] Test error handling
- [ ] Test configuration loading
- [ ] All integration tests passing

### Day 2: Update Unit Tests

- [ ] Review all test files
- [ ] Remove CLI-specific mocks
- [ ] Update to test service layer directly
- [ ] Ensure async tests use `pytest.mark.asyncio`
- [ ] All unit tests passing

### Day 3: Coverage Testing

```bash
pytest --cov=src/nanuk_mcp --cov-report=html --cov-report=term
```

- [ ] Run coverage report
- [ ] Current coverage: _____ %
- [ ] **Target: >90%**
- [ ] Identify gaps
- [ ] Add tests for uncovered code
- [ ] Re-run until >90%
- [ ] Commit: "test: achieve >90% coverage"

**Coverage by module:**
- [ ] `mcp/` - target 95%
- [ ] `services/` - target 93%
- [ ] `catalog/` - target 92%
- [ ] `dependency/` - target 92%
- [ ] `lineage/` - target 90%
- [ ] `core/` - target 91%

### Day 4: Performance Testing

```python
# tests/performance/test_performance.py
# (See examples in main plan)
```

- [ ] Create performance test suite
- [ ] Test query execution speed (<500ms)
- [ ] Test catalog build speed (<10s for small DB)
- [ ] Test MCP server startup (<2s)
- [ ] All benchmarks passing

### Day 4-5: End-to-End Testing

Manual testing checklist:

- [ ] Install fresh: `pip install dist/nanuk_mcp-2.0.0-*.whl`
- [ ] Start MCP server: `SNOWFLAKE_PROFILE=test nanuk-mcp`
- [ ] Server starts without errors
- [ ] Test with Claude Code:
  - [ ] Configure .mcp.json
  - [ ] Ask Claude to test connection
  - [ ] Ask Claude to run query
  - [ ] Ask Claude to build catalog
- [ ] Test with Cursor (if available)
- [ ] Test with VS Code (if available)
- [ ] Test programmatic usage:
  ```python
  from nanuk_mcp import QueryService, load_config
  config = load_config()
  service = QueryService(config)
  result = await service.execute("SELECT 1")
  ```
- [ ] All manual tests successful

**Phase 5 Complete?** → Proceed to Release

---

## Phase 6: Beta Release & Launch (Week 6)

### Day 1-2: Beta Release (v2.0.0-beta.1)

- [ ] Update version in pyproject.toml: `2.0.0-beta.1`
- [ ] Run full test suite: `pytest tests/`
- [ ] Build package: `uv build`
- [ ] Test package: `pip install dist/nanuk_mcp-2.0.0b1-*.whl`
- [ ] Create GitHub release: `v2.0.0-beta.1`
  - [ ] Tag: `git tag v2.0.0-beta.1`
  - [ ] Push: `git push origin v2.0.0-beta.1`
  - [ ] Create release on GitHub
  - [ ] Add release notes
- [ ] Upload to PyPI (test): `twine upload --repository testpypi dist/*`
- [ ] Test install from TestPyPI
- [ ] Announce beta in GitHub Discussions

### Day 2-3: Beta Testing

Recruit beta testers:

- [ ] Post in GitHub Discussions
- [ ] Reach out to known users
- [ ] Ask for testing feedback

Testing checklist for beta testers:

- [ ] Installation smooth
- [ ] MCP server starts
- [ ] All tools work
- [ ] Migration guide helpful
- [ ] No critical bugs
- [ ] Performance acceptable

### Day 3: Collect Feedback

- [ ] Review GitHub Issues
- [ ] Review Discussions feedback
- [ ] Document all issues
- [ ] Prioritize critical vs. nice-to-have
- [ ] Plan fixes

### Day 4: Fix Critical Issues

- [ ] Fix all critical bugs
- [ ] Update documentation if needed
- [ ] Run full test suite
- [ ] Re-test manually
- [ ] Commit fixes: "fix: address beta feedback"

### Day 5: Official Release (v2.0.0)

- [ ] Update version: `2.0.0` (remove beta)
- [ ] Update CHANGELOG.md with full v2.0.0 notes
- [ ] Run full test suite: `pytest tests/`
- [ ] Build final package: `uv build`
- [ ] Create GitHub release: `v2.0.0`
  - [ ] Tag: `git tag v2.0.0`
  - [ ] Push: `git push origin v2.0.0`
  - [ ] Create release on GitHub
  - [ ] Add comprehensive release notes
  - [ ] Highlight breaking changes
  - [ ] Link to migration guide
- [ ] Upload to PyPI: `twine upload dist/*`
- [ ] Verify PyPI page looks good
- [ ] Announce release:
  - [ ] GitHub Discussions
  - [ ] Update README badge
  - [ ] Social media (if applicable)
  - [ ] Blog post (optional)

**🎉 v2.0.0 RELEASED! 🎉**

---

## Post-Release Monitoring (Week 7+)

### Week 1 Post-Release

- [ ] Monitor GitHub Issues (target: <5 critical)
- [ ] Track PyPI downloads
- [ ] Answer migration questions
- [ ] Release v2.0.1 if critical bugs found

### Week 2-4 Post-Release

- [ ] Collect user feedback
- [ ] Track adoption metrics
- [ ] Plan v2.1.0 features
- [ ] Write blog post on experience

### Month 2-3

- [ ] Evaluate success metrics
- [ ] Continue v1.x support (bug fixes only)
- [ ] Build MCP-first community

---

## Success Criteria

Check all boxes to confirm successful v2.0 launch:

### Code Quality
- [ ] 2,000+ LOC deleted
- [ ] Test coverage >90%
- [ ] Zero import errors
- [ ] All tests passing
- [ ] Performance maintained

### Documentation
- [ ] README rewritten (MCP-only)
- [ ] Migration guide complete
- [ ] All docs updated
- [ ] CLI references removed

### Release
- [ ] v2.0.0 published to PyPI
- [ ] GitHub release created
- [ ] No critical bugs in first week
- [ ] <20 migration issues in first month

### Adoption
- [ ] Migration guide rated helpful (>80%)
- [ ] PyPI downloads >1,000 in first month
- [ ] MCP adoption >70% within 3 months

**All criteria met?** → v2.0 is a SUCCESS! 🚀

---

## Emergency Rollback

If v2.0 launch fails critically:

- [ ] Identify issue severity (critical vs. fixable)
- [ ] If critical and unfixable quickly:
  ```bash
  git revert <v2.0-commit>
  git push
  git tag v1.9.1
  git push --tags
  ```
- [ ] Announce rollback on GitHub
- [ ] Investigate root cause
- [ ] Fix in feature branch
- [ ] Re-release when ready

---

## Notes & Learnings

Document key learnings during implementation:

**What went well:**
-
-

**What was challenging:**
-
-

**Unexpected issues:**
-
-

**Future improvements:**
-
-

---

**Checklist Version:** 1.0
**Date:** October 7, 2025
**Status:** Ready to execute
**Estimated Time:** 5-6 weeks

**Next Step:** Complete Pre-Flight Checks, then start Phase 1 Day 1! 🚀
